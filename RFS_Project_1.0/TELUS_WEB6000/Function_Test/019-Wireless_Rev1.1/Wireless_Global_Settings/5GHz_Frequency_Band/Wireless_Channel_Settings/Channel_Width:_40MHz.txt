*** Settings ***
Resource          ../../../../../Variables_ENV.txt
Resource          ../../../../../Share_Resource.txt
Resource          ../../../../../GUI_Keyword.txt

*** Test Cases ***
RFW-T6000-12573:Channel In Use_Manual_40MHz
    #1. Ensure Wireless Radio is enabled in 2.4GHz band and Channel Width is set to 40MHz (Above).    2. Manually specify a Wireless Channel for example, 6 and Apply.
    TR_SPV    Device.WiFi.Radio.1.Enable=1 boolean    Device.WiFi.Radio.1.AutoChannelEnable=0 boolean    Device.WiFi.Radio.1.OperatingChannelBandwidth=40MHz string    Device.WiFi.Radio.1.ExtensionChannel=AboveControlChannel string    Device.WiFi.Radio.1.Channel=6 unsignedInt
    #3. Capture Beacon packets sent by DUT in 2.4GHz band and check the current channel available in 'HT IE (61)' in Beacon packet.
    ${Channel}=    TR_GPV_Return_Value    Device.WiFi.Radio.1.Channel
    FUN_Parse WiFi_L2 Packets    wlan.fc.type_subtype == 0x08 and wlan.bssid == 00:18:01:00:7b:ab and wlan_mgt.tag.interpretation == "Current Channel: ${Channel}" and wlan_mgt.ht.info.secchanoffset == 0x01    True
    #4. Go to check Expected Results.    1. Primary Channel in Beacon packet is the same as what you configured.    2. Value of Secondary Channel Offset must be 'Secondary channel is above the primary channel'.    3. Do GUI Check: Channel shown on GUI page(s) listed in the GUI Check List should be same as what you configured.
    ${GUI_Channel}=    GUI_Check_Channel_2G    ${U_DUT_BR0_IP}    ${U_DUT_HTTP_USER}    ${U_DUT_HTTP_PWD}    False
    Should Be Equal As Strings    ${GUI_Channel}    ${Channel}
    #5. Reboot DUT.
    #TR_Reboot_DUT
    #6. Go to check Expected Results again after DUT boots up.
    ${Channel}=    TR_GPV_Return_Value    Device.WiFi.Radio.1.Channel
    FUN_Parse WiFi_L2 Packets    wlan.fc.type_subtype == 0x08 and wlan.bssid == 00:18:01:00:7b:ab and wlan_mgt.tag.interpretation == "Current Channel: ${Channel}" and wlan_mgt.ht.info.secchanoffset == 0x01    True
    ${GUI_Channel}=    GUI_Check_Channel_2G    ${U_DUT_BR0_IP}    ${U_DUT_HTTP_USER}    ${U_DUT_HTTP_PWD}    False
    Should Be Equal As Strings    ${GUI_Channel}    ${Channel}
