*** Settings ***
Library           SSHLibrary
Library           OperatingSystem
Library           ../library/Capture_Packets/Capture_Packets.py
Resource          GUI_Keyword.txt
Library           Selenium2Library
Library           ../library/TR/TR.py

*** Keywords ***
TR_SPV
    [Arguments]    @{SPV_arg}
    ${Check_SPV}    DoSPV    @{SPV_arg}
    Should Be True    ${Check_SPV}

TR_GPV_Check
    [Arguments]    @{GPV_arg}
    ${Check_GPV}    DoGPV    @{GPV_arg}
    Should Be True    ${Check_GPV}

TR_SPV_ON_GW
    [Arguments]    @{SPV_arg}
    ${Check_SPV}    DoSPVOnGW    @{SPV_arg}
    Should Be True    ${Check_SPV}

TR_GPV_ON_GW
    [Arguments]    @{GPV_arg}
    ${Check_GPV}    DoGPVOnGW    @{GPV_arg}
    Should Be True    ${Check_GPV}

TR_GPV_Return_Value
    [Arguments]    ${arg1}
    ${Check_GPV}    DoGPV    ${arg1}
    Should Be True    ${Check_GPV}
    ${rc}=    getGPVResult    ${arg1}

FUN_SSH_DUT
    [Arguments]    ${ssh_address}    ${username}    ${password}
    SSHLibrary.Open Connection    ${ssh_address}
    ${x}=    Run Keyword And Return Status    SSHLibrary.Login    ${username}    ${password}
    SSHLibrary.Close Connection
    Log    ==========SSH Result is ${x}==========
    [Return]    ${x}

FUN_PingTest
    [Arguments]    ${destIP}    ${count}    ${interface}
    [Documentation]    Use Linux ping command return value should be "0", and output should not contain "100% packet loss"
    ...    Arguments: ${destIP} | ${count} | ${interface}
    ...
    ...    Usage:
    ...    PingTest | 192.168.1.254 | 4 | eth2
    ...
    ...    Arguments can be a real value or variable defined in Variables list.
    ${rc}    ${PingResult}    Run And Return Rc And Output    ping ${destIP} -c ${count} -I ${interface}
    Should Be Equal As Numbers    ${rc}    0
    Should Not Contain    ${PingResult}    , 100% packet loss

FUN_GetIP
    [Arguments]    ${interface}
    [Documentation]    Use dhclient get IP address on identify interface, and return value should contain 'renewal', otherwise the keyword will not pass.
    ...
    ...    Example:
    ...
    ...    GetIP | ${U_CUSTOM_IF1}
    Run    dhclient -r ${interface}
    ${GetIP_Result}    Run    dhclient -v ${interface}
    Should contain    ${GetIP_Result}    renewal

FUN_Release_IP
    [Arguments]    ${interface}
    [Documentation]    Release the IP by dhclient
    ...
    ...    Arguments: ${interface}
    ...
    ...    Example:
    ...    Release_IP | ${U_CUSTOM_IF1}
    Run    dhclient -r ${interface}

TR_SPV_SSH_Disabled
    DoSPV    Device.X_ACTIONTEC_COM_RemoteLogin.Enable =0 boolean
    ${Init_GPV}=    DoGPV    Device.X_ACTIONTEC_COM_RemoteLogin.Enable=0
    Should Be True    ${Init_GPV}

TR_SPV_SSH_Enabled
    DoSPV    Device.X_ACTIONTEC_COM_RemoteLogin.Enable =1 boolean    Device.X_ACTIONTEC_COM_RemoteLogin.Port=22 unsignedInt    Device.X_ACTIONTEC_COM_RemoteLogin.Protocol=SSH string    Device.X_ACTIONTEC_COM_RemoteLogin.IdleTimeout=60 unsignedInt    Device.X_ACTIONTEC_COM_RemoteLogin.Username=admin string    Device.X_ACTIONTEC_COM_RemoteLogin.Password=1 string
    ${Init_GPV}=    DoGPV    Device.X_ACTIONTEC_COM_RemoteLogin.Enable=1
    Should Be True    ${Init_GPV}

FUN_ConfigIP
    [Arguments]    ${interface}    ${address}=192.168.1.100
    ${rc}    Run And Return Rc    ifconfig ${interface} ${address}
    Should Be Equal As Numbers    ${rc}    0
    ${rc}    ${output}    Run And Return Rc And Output    ifconfig ${interface}
    Should Contain    ${output}    ${address}

FUN_Capture Beacon
    [Arguments]    ${filter_rule}    ${negtive}
    Start Capture On Lan    \    output=/tmp/test1.pcap    filter=Beacon
    sleep    2
    Stop Capture On Lan    raw=/tmp/test1.pcap
    ${rc}=    Parse Packets    filter=${filter_rule}    raw=/tmp/test1.pcap    output=/tmp/filter.log    negtive=${negtive}
    Should Be True    ${rc}

TR_SPV_WiFiRadio_Enable
    DoSPV    Device.WiFi.Radio.1.Enable=1 boolean
    ${Init_GPV}=    DoGPV    Device.WiFi.Radio.1.Enable=1
    Should Be True    ${Init_GPV}

TR_SPV_WiFiRadio_Disable
    DoSPV    Device.WiFi.Radio.1.Enable=0 boolean
    ${Init_GPV}=    DoGPV    Device.WiFi.Radio.1.Enable=0
    Should Be True    ${Init_GPV}

TR_Reboot_DUT
    Reset DUT by jacs
